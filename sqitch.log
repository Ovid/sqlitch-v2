============================================================
Sqitch vs. Sqlitch Functional Equivalence Test (User-Focused)
============================================================

Checking for required commands...
Setting up test environment...
Test directories created.


============================================================
▶️  STEP 1: Initialize Project
    COMMAND: sqlitch init flipr --uri https://github.com/sqitchers/sqitch-sqlite-intro/ --engine sqlite
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Created sqitch.conf
Created sqitch.plan
Created deploy/
Created revert/
Created verify/

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created sqitch.conf
Created sqitch.plan
Created deploy/
Created revert/
Created verify/

    ✅ Step completed successfully

============================================================
▶️  STEP 2: Configure User Name
    COMMAND: sqlitch config user.name Test User
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Set user.name in local scope
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Set user.name in local scope

    ✅ Step completed successfully

============================================================
▶️  STEP 3: Configure User Email
    COMMAND: sqlitch config user.email test@example.com
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Set user.email in local scope
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Set user.email in local scope

    ✅ Step completed successfully

============================================================
▶️  STEP 4: Disable Pager
    COMMAND: sqlitch config --bool core.pager false
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Set core.pager in local scope
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Set core.pager in local scope

    ✅ Step completed successfully

============================================================
▶️  STEP 5: Add 'users' Table
    COMMAND: sqlitch add users -n Creates table to track our users.
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Created deploy/users.sql
Created revert/users.sql
Created verify/users.sql
Added "users" to sqitch.plan

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created deploy/users.sql
Created revert/users.sql
Created verify/users.sql
Added "users" to sqitch.plan

    ✅ Step completed successfully

============================================================
▶️  STEP 6: Deploy 'users' Table
    COMMAND: sqlitch deploy db:sqlite:flipr_test.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Adding registry tables to db:sqlite:sqitch.db
Deploying changes to db:sqlite:flipr_test.db
  + users .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
Adding registry tables to db:sqlite:/Users/poecurt/projects/sqlitch/uat/sqlitch_results/sqitch.db
  + users
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,3 +1,4 @@
-Adding registry tables to db:sqlite:sqitch.db
-Deploying changes to db:sqlite:flipr_test.db
-  + users .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+Adding registry tables to db:sqlite:/Users/poecurt/projects/sqlitch/uat/sqlitch_results/sqitch.db
+  + users
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 7: Verify 'users' Deployment
    COMMAND: sqlitch verify db:sqlite:flipr_test.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Verifying db:sqlite:flipr_test.db
  * users .. ok
Verify successful

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Verifying flipr_test
  * users .. ok
Verify successful
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,3 +1,3 @@
-Verifying db:sqlite:flipr_test.db
+Verifying flipr_test
   * users .. ok
 Verify successful

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 8: Check Status After Deploy
    COMMAND: sqlitch status db:sqlite:flipr_test.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
# On database db:sqlite:flipr_test.db
# Project:  flipr
# Change:   a0fe52054a0eea0eb2f550b430195c872b57a746
# Name:     users
# Deployed: 2025-10-11 12:00:42 +0200
# By:       Test User <test@example.com>
# 
Nothing to deploy (up-to-date)

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
# On database db:sqlite:flipr_test.db
# Project:  flipr
# Change:   bd29107711961208b5569584ab843e0690345cce
# Name:     users
# Deployed: 2025-10-11T10:00:42.448746+00:00
# By:       Test User <test@example.com>
# 
Nothing to deploy (up-to-date)
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -2,7 +2,7 @@
 # Project:  flipr
 # Change:   [REDACTED_CHANGE_ID]
 # Name:     users
-# Deployed: 2025-10-11 12:00:42 +0200
+# Deployed: 2025-10-11T10:00:42.448746+00:00
 # By:       Test User <test@example.com>
 # 
 Nothing to deploy (up-to-date)

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 9: Check DB Schema with sqlite3
    COMMAND: sqlite3 flipr_test.db .tables
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
users

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
users

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 10: Revert 'users' Table
    COMMAND: sqlitch revert db:sqlite:flipr_test.db -y
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Reverting all changes from db:sqlite:flipr_test.db
  - users .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Reverting all changes from db:sqlite:flipr_test.db
  - users .. ok

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 11: Verify Revert with sqlite3
    COMMAND: sqlite3 flipr_test.db .tables
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 12: Check Sqitch Log
    COMMAND: sqlitch log db:sqlite:flipr_test.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
On database db:sqlite:flipr_test.db
Revert a0fe52054a0eea0eb2f550b430195c872b57a746
Name:      users
Committer: Test User <test@example.com>
Date:      2025-10-11 12:00:43 +0200

    Creates table to track our users.

Deploy a0fe52054a0eea0eb2f550b430195c872b57a746
Name:      users
Committer: Test User <test@example.com>
Date:      2025-10-11 12:00:42 +0200

    Creates table to track our users.


    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
On database db:sqlite:flipr_test.db
Revert bd29107711961208b5569584ab843e0690345cce
Name:      users
Committer: Test User <test@example.com>
Date:      2025-10-11T10:00:43.254057+00:00

    Creates table to track our users.

Deploy bd29107711961208b5569584ab843e0690345cce
Name:      users
Committer: Test User <test@example.com>
Date:      2025-10-11T10:00:42.448746+00:00
    Creates table to track our users.

⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -2,13 +2,12 @@
 Revert [REDACTED_CHANGE_ID]
 Name:      users
 Committer: Test User <test@example.com>
-Date:      2025-10-11 12:00:SS +0200
+Date:      2025-10-11T10:00:SS+00:00
 
     Creates table to track our users.
 
 Deploy [REDACTED_CHANGE_ID]
 Name:      users
 Committer: Test User <test@example.com>
-Date:      2025-10-11 12:00:SS +0200
-
+Date:      2025-10-11T10:00:SS+00:00
     Creates table to track our users.


    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 13: Add Target 'flipr_test'
    COMMAND: sqlitch target add flipr_test db:sqlite:flipr_test.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Added target flipr_test
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Added target flipr_test

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 14: Add Engine for Target
    COMMAND: sqlitch engine add sqlite flipr_test
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created engine 'sqlite'
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Created engine 'sqlite'

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 15: Enable Deploy Verification
    COMMAND: sqlitch config --bool deploy.verify true
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Set deploy.verify in local scope
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Set deploy.verify in local scope

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 16: Enable Rebase Verification
    COMMAND: sqlitch config --bool rebase.verify true
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Set rebase.verify in local scope
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -0,0 +1 @@
+Set rebase.verify in local scope

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 17: Deploy Again with Target
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + users .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + users
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,2 +1,3 @@
-Deploying changes to flipr_test
-  + users .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + users
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 18: Add 'flips' Table
    COMMAND: sqlitch add flips --requires users -n Adds table for storing flips.
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Created deploy/flips.sql
Created revert/flips.sql
Created verify/flips.sql
Added "flips [users]" to sqitch.plan

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created deploy/flips.sql
Created revert/flips.sql
Created verify/flips.sql
Added "flips" to sqitch.plan
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,4 +1,4 @@
 Created deploy/flips.sql
 Created revert/flips.sql
 Created verify/flips.sql
-Added "flips [users]" to sqitch.plan+Added "flips" to sqitch.plan

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 19: Deploy 'flips' Table
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + flips .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + flips
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,2 +1,3 @@
-Deploying changes to flipr_test
-  + flips .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + flips
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 20: Verify All Deployments
    COMMAND: sqlitch verify
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Verifying flipr_test
  * users .. ok
  * flips .. ok
Verify successful

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Verifying flipr_test
  * users .. ok
  * flips .. ok
Verify successful

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 21: Check DB Schema for 'users' and 'flips'
    COMMAND: sqlite3 flipr_test.db .tables
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
flips  users

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
flips  users

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 22: Partial Revert to HEAD^
    COMMAND: sqlitch revert --to @HEAD^ -y
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Reverting changes to users from flipr_test
  - flips .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Reverting changes to users from flipr_test
  - flips .. ok

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 23: Verify Partial Revert
    COMMAND: sqlite3 flipr_test.db .tables
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
users

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
users

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 24: Deploy All Again
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + flips .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + flips
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,2 +1,3 @@
-Deploying changes to flipr_test
-  + flips .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + flips
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 25: Add 'userflips' View
    COMMAND: sqlitch add userflips --requires users --requires flips -n Creates the userflips view.
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Created deploy/userflips.sql
Created revert/userflips.sql
Created verify/userflips.sql
Added "userflips [users flips]" to sqitch.plan

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created deploy/userflips.sql
Created revert/userflips.sql
Created verify/userflips.sql
Added "userflips" to sqitch.plan
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,4 +1,4 @@
 Created deploy/userflips.sql
 Created revert/userflips.sql
 Created verify/userflips.sql
-Added "userflips [users flips]" to sqitch.plan+Added "userflips" to sqitch.plan

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 26: Deploy 'userflips' View
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + userflips .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + userflips
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,2 +1,3 @@
-Deploying changes to flipr_test
-  + userflips .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + userflips
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 27: Full Revert
    COMMAND: sqlitch revert -y
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Reverting all changes from flipr_test
  - userflips .. ok
  - flips ...... ok
  - users ...... ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Reverting all changes from flipr_test
  - userflips .. ok
  - flips .. ok
  - users .. ok
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,4 +1,4 @@
 Reverting all changes from flipr_test
   - userflips .. ok
-  - flips ...... ok
-  - users ...... ok+  - flips .. ok
+  - users .. ok

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 28: Full Redeploy
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + users ...... ok
  + flips ...... ok
  + userflips .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + users
  + flips
  + userflips
Deployment complete. Applied 3 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,4 +1,5 @@
-Deploying changes to flipr_test
-  + users ...... ok
-  + flips ...... ok
-  + userflips .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + users
+  + flips
+  + userflips
+Deployment complete. Applied 3 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 29: Tag Release v1.0.0-dev1
    COMMAND: sqlitch tag v1.0.0-dev1 -n Tag v1.0.0-dev1.
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Tagged "userflips" with @v1.0.0-dev1 in sqitch.plan

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Tagged userflips with @v1.0.0-dev1
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1 +1 @@
-Tagged "userflips" with @v1.0.0-dev1 in sqitch.plan+Tagged userflips with @v1.0.0-dev1

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 30: Deploy Tag to New DB
    COMMAND: sqlitch deploy db:sqlite:dev/flipr.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Adding registry tables to db:sqlite:dev/sqitch.db
Deploying changes to db:sqlite:dev/flipr.db
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:dev/flipr.db'.
Adding registry tables to db:sqlite:/Users/poecurt/projects/sqlitch/uat/sqlitch_results/dev/sqitch.db
  + users
  + flips
  + userflips
Deployment complete. Applied 3 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,5 +1,6 @@
-Adding registry tables to db:sqlite:dev/sqitch.db
-Deploying changes to db:sqlite:dev/flipr.db
-  + users ................... ok
-  + flips ................... ok
-  + userflips @v1.0.0-dev1 .. ok+Deploying plan 'flipr' to target 'db:sqlite:dev/flipr.db'.
+Adding registry tables to db:sqlite:/Users/poecurt/projects/sqlitch/uat/sqlitch_results/dev/sqitch.db
+  + users
+  + flips
+  + userflips
+Deployment complete. Applied 3 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 31: Check Status of Tagged DB
    COMMAND: sqlitch status db:sqlite:dev/flipr.db
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
# On database db:sqlite:dev/flipr.db
# Project:  flipr
# Change:   77a7d2bb619ab01f5bbc722e8f8708c7ac4e9a41
# Name:     userflips
# Tag:      @v1.0.0-dev1
# Deployed: 2025-10-11 12:00:47 +0200
# By:       Test User <test@example.com>
# 
Nothing to deploy (up-to-date)

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
# On database db:sqlite:dev/flipr.db
# Project:  flipr
# Change:   2fed3506f560d8a04761838c3d91013c8d8a9bf2
# Name:     userflips
# Tag:      @v1.0.0-dev1
# Deployed: 2025-10-11T10:00:47.691116+00:00
# By:       Test User <test@example.com>
# 
Nothing to deploy (up-to-date)
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -3,7 +3,7 @@
 # Change:   [REDACTED_CHANGE_ID]
 # Name:     userflips
 # Tag:      @v1.0.0-dev1
-# Deployed: 2025-10-11 12:00:47 +0200
+# Deployed: 2025-10-11T10:00:47.691116+00:00
 # By:       Test User <test@example.com>
 # 
 Nothing to deploy (up-to-date)

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 32: Create Bundle
    COMMAND: sqlitch bundle
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Bundling into bundle
Writing config
Writing plan
Writing scripts
  + users
  + flips
  + userflips @v1.0.0-dev1

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Bundled project to bundle
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,7 +1 @@
-Bundling into bundle
-Writing config
-Writing plan
-Writing scripts
-  + users
-  + flips
-  + userflips @v1.0.0-dev1+Bundled project to bundle

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 33: Deploy Bundle to New DB
    COMMAND: sqlitch deploy db:sqlite:flipr_prod.db -C bundle
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Adding registry tables to db:sqlite:sqitch.db
Deploying changes to db:sqlite:flipr_prod.db
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_prod.db'.
Nothing to deploy (up-to-date).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,5 +1,2 @@
-Adding registry tables to db:sqlite:sqitch.db
-Deploying changes to db:sqlite:flipr_prod.db
-  + users ................... ok
-  + flips ................... ok
-  + userflips @v1.0.0-dev1 .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_prod.db'.
+Nothing to deploy (up-to-date).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 34: Add 'hashtags' Table
    COMMAND: sqlitch add hashtags --requires flips -n Adds table for storing hashtags.
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Created deploy/hashtags.sql
Created revert/hashtags.sql
Created verify/hashtags.sql
Added "hashtags [flips]" to sqitch.plan

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Created deploy/hashtags.sql
Created revert/hashtags.sql
Created verify/hashtags.sql
Added "hashtags" to sqitch.plan
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,4 +1,4 @@
 Created deploy/hashtags.sql
 Created revert/hashtags.sql
 Created verify/hashtags.sql
-Added "hashtags [flips]" to sqitch.plan+Added "hashtags" to sqitch.plan

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 35: Deploy 'hashtags' Table
    COMMAND: sqlitch deploy
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Deploying changes to flipr_test
  + hashtags .. ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
  + hashtags
Deployment complete. Applied 1 change(s).
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -1,2 +1,3 @@
-Deploying changes to flipr_test
-  + hashtags .. ok+Deploying plan 'flipr' to target 'db:sqlite:flipr_test.db'.
+  + hashtags
+Deployment complete. Applied 1 change(s).

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 36: Check Status with Tags
    COMMAND: sqlitch status --show-tags
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
# On database flipr_test
# Project:  flipr
# Change:   53fe2d8f649f94f28088156e01412ecca4dce647
# Name:     hashtags
# Deployed: 2025-10-11 12:00:48 +0200
# By:       Test User <test@example.com>
# 
# Tag:
#   @v1.0.0-dev1 - 2025-10-11 12:00:48 +0200 - Test User <test@example.com>
# 
Nothing to deploy (up-to-date)

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
# On database flipr_test
# Project:  flipr
# Change:   97b14653b9c711d850186aca7b821a3693121f0c
# Name:     hashtags
# Deployed: 2025-10-11T10:00:49.066391+00:00
# By:       Test User <test@example.com>
# 
Nothing to deploy (up-to-date)
⚠️  Command output differs (this may be OK if user state matches)

Output diff:
--- sqitch(out)
+++ sqlitch(out)
@@ -2,10 +2,7 @@
 # Project:  flipr
 # Change:   [REDACTED_CHANGE_ID]
 # Name:     hashtags
-# Deployed: 2025-10-11 12:00:48 +0200
+# Deployed: 2025-10-11T10:00:49.066391+00:00
 # By:       Test User <test@example.com>
 # 
-# Tag:
-#   @v1.0.0-dev1 - 2025-10-11 12:00:SS +0200 - Test User <test@example.com>
-# 
 Nothing to deploy (up-to-date)

    ✅ User-visible database 'sqitch.db' matches

    ✅ User-visible database 'flipr_test.db' matches

    ✅ Step completed successfully

============================================================
▶️  STEP 37: Rebase Plan
    COMMAND: sqlitch rebase -y
============================================================

    ┌───────────────────────────┐
    │   Running sqitch (💎)     │
    └───────────────────────────┘
Reverting all changes from flipr_test
  - hashtags ................ ok
  - userflips @v1.0.0-dev1 .. ok
  - flips ................... ok
  - users ................... ok
Deploying changes to flipr_test
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok
  + hashtags ................ ok

    ┌───────────────────────────┐
    │   Running sqlitch (✨)    │
    └───────────────────────────┘
Reverting all changes from flipr_test
  - hashtags .. ok
  - userflips .. not ok
Rebase revert phase failed: Revert failed for change 'userflips': FOREIGN KEY constraint failed

⛔️ TEST FAILED (Step 37): Exit codes differ. sqitch: 0, sqlitch: 1
     Command: sqlitch rebase -y
Execution failed. Test directories and logs ('uat/sqitch_results', 'uat/sqlitch_results', 'uat/sqitch_results/uat.log', 'uat/sqlitch_results/uat.log') are left for inspection.

To reproduce this failure:
  1. Check logs: uat/sqitch_results/uat.log and uat/sqlitch_results/uat.log
  2. Examine directories: uat/sqitch_results and uat/sqlitch_results
  3. Failed command: sqlitch rebase -y
