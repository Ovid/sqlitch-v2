# SQLitch v1.0.0 Migration Guide

This guide explains how to move existing Sqitch-based SQLite projects to SQLitch 1.0.0 while preserving full interoperability.

## 1. Prerequisites
- Sqitch v1.5.3 (or compatible) installed and on PATH for verification.
- Python 3.11+ environment with `sqlitch==1.0.0` installed (`pip install .[dev]` from the repository root for development setups).
- Access to the projectâ€™s Sqitch plan files and registry database.

## 2. Verify Existing State with Sqitch
1. Run Sqitch status on your existing targets:
   ```bash
   sqitch status <target>
   ```
2. Ensure Sqitch deploy/verify exit successfully before introducing SQLitch.
3. Keep a sanitized log of the output for comparison (timestamps and change IDs may differ; see evidence format in `specs/005-lockdown/artifacts/uat/`).

## 3. Install and Configure SQLitch
1. Install SQLitch 1.0.0:
   ```bash
   pip install sqlitch==1.0.0
   ```
2. Copy or point SQLitch at the same `sqitch.plan`, deploy, revert, and verify directories used by Sqitch.
3. Optional: create a dedicated target mapping mirroring your Sqitch configuration:
   ```bash
   sqlitch target add <name> <uri>
   ```

## 4. Validate Compatibility
SQLitch 1.0.0 ships with three manual harnesses that mirror the steps validated in the release:
- Side-by-side parity: `python uat/side-by-side.py --out side-by-side.log`
- Forward compatibility (SQLitch first, Sqitch second): `python uat/forward-compat.py --out forward-compat.log`
- Backward compatibility (Sqitch first, SQLitch second): `python uat/backward-compat.py --out backward-compat.log`

Review the generated logs against the reference evidence stored at:
- `specs/005-lockdown/artifacts/uat/side-by-side.log`
- `specs/005-lockdown/artifacts/uat/forward-compat.log`
- `specs/005-lockdown/artifacts/uat/backward-compat.log`

Only cosmetic differences (additional SQLitch status lines, ISO 8601 timestamps without timezone offsets, bundle messaging) are expected. Any behavioral difference (database mismatch, divergent error handling) requires investigation before production rollout.

## 5. Upgrade Workflow
1. Switch day-to-day deploy/verify/revert operations to SQLitch commands.
2. Keep Sqitch installed for cross-tool verification until confidence is established.
3. For plan reworks, SQLitch now supports duplicate change names and tag-qualified dependencies, matching Sqitch behavior.
4. Continue to run the forward and backward compatibility harnesses for major plan updates or before tagging releases.

## 6. Rollback Strategy
- SQLitch does not mutate Sqitch registries beyond canonical operations; you can revert to Sqitch at any time.
- If issues arise, rerun `sqitch status` and `sqitch verify` to confirm registry health, then engage with the parity evidence logs for diagnosis.

## 7. Known Gaps
- CLI type-checking warnings (`mypy --strict`) remain and do not affect runtime behavior; tracked for post-1.0.
- Upstream `pip` advisory (CVE-2025-8869) requires vigilance when installing dependencies.

By following these steps and comparing your results with the curated evidence captured for the 1.0.0 release, you can confidently adopt SQLitch while maintaining full interoperability with existing Sqitch deployments.
